<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4SP - DASHBOARD</title>
    
    <!-- Load Geist Font and TailwindCSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.1.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../navigation.js"></script>

    <!-- 
        *** FIX: Load global Firebase SDKs BEFORE navigation-test.js ***
        This is necessary for the global 'firebase' object to be defined.
    -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <!-- Load the main AI script AFTER Firebase is globally available -->
    <script src="../humanity-agent.js"></script>


    <!-- Firebase Initialization and Clock Logic -->
    <script type="module">
        import { firebaseConfig } from '../firebase-config.js';

        // Initialize Firebase globally using the window object for older SDK compatibility
        // Only initialize if 'firebase' is available (from the scripts above)
        if (typeof firebase !== 'undefined') {
            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth(app);
            // Optionally set global variables for modules that need them
            window.db = firebase.firestore(app);
            window.auth = auth;
        }


        const dateTimeElement = document.getElementById('date-time-display');
        const redirectPath = '../index.html';

        /**
         * Updates the date and time display every second.
         */
        function updateDateTime() {
            const now = new Date();
            
            // Format time (e.g., 04:20 PM:23)
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            const timeString = now.toLocaleTimeString('en-US', timeOptions);
            
            // Format date (e.g., Saturday, October 4, 2025)
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('en-US', dateOptions);

            if (dateTimeElement) {
                // Ensure seconds are formatted to 2 digits for consistent width
                const parts = timeString.split(':');
                const timeWithColon = `${parts[0]}:${parts[1]}`;
                const secondsAndAmPm = parts[2];
                
                dateTimeElement.innerHTML = `
                    <div class="text-7xl font-light">${timeWithColon}<span class="text-3xl font-normal ml-2">${secondsAndAmPm}</span></div>
                    <div class="text-3xl font-thin mt-2">${dateString}</div>
                `;
            }
        }

        /**
         * Handles user authentication state and redirects if logged out.
         */
        if (typeof firebase !== 'undefined' && firebase.auth) {
            firebase.auth().onAuthStateChanged((user) => {
                if (!user) {
                    // User is signed out. Redirect immediately.
                    console.log("User logged out. Redirecting to:", redirectPath);
                    window.location.replace(redirectPath);
                } else {
                    // User is signed in. Start the clock update.
                    console.log("User signed in. UID:", user.uid);
                    
                    // Set the initial time and then update it every second
                    updateDateTime();
                    setInterval(updateDateTime, 1000);
                }
            });
        }


        // Add CSS for minimal black screen look
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                /* Apply Geist font universally */
                body { 
                    font-family: 'Geist', sans-serif; 
                    background-color: #000000;
                    color: #FFFFFF;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    height: 100vh;
                    margin: 0;
                    text-align: center;
                }
                /* Ensure HTML and body take full viewport height */
                html { height: 100%; }
            </style>
        `);
    </script>
</head>
<body>
    <div id="date-time-display" class="tracking-tighter p-8 rounded-xl bg-white/5 backdrop-blur-sm shadow-2xl">
        <!-- Content will be injected by JavaScript -->
        <p class="text-xl">Loading time and authentication check...</p>
    </div>
</body>
</html>
