<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Broadcast Test Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { min-height: 100vh; display: flex; align-items: center; justify-content: center; background-color: #f7f7f7; font-family: sans-serif; }
        .container { background-color: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); max-width: 400px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-xl font-bold mb-4">Test Broadcast Center ðŸ“¢</h1>
        <p class="text-gray-600 mb-6">Press the button below to send a notification to *all* currently signed-in users with a valid token.</p>
        
        <textarea id="messageInput" rows="3" class="w-full p-2 border border-gray-300 rounded-md mb-4 focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="Enter custom message (optional)"></textarea>

        <button id="broadcastButton" 
                class="w-full bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700 transition duration-150 ease-in-out disabled:opacity-50"
                disabled>
            Initialize Firebase & Load...
        </button>

        <p id="statusMessage" class="mt-4 text-sm text-gray-500"></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-functions-compat.js"></script>
    
    <script>
        // ðŸš¨ IMPORTANT: Use your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAZBKAckVa4IMvJGjcyndZx6Y1XD52lgro",
            authDomain: "project-zirconium.firebaseapp.com",
            projectId: "project-zirconium",
            storageBucket: "project-zirconium.firebasestorage.app",
            messagingSenderId: "1096564243475",
            appId: "1:1096564243475:web:6d0956a70125eeea1ad3e6",
            measurementId: "G-1D4F692C1Q"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const functions = app.functions('us-central1'); // Use the region where your function is deployed
        const auth = app.auth();
        const sendBroadcast = functions.httpsCallable('sendTestBroadcast');

        const broadcastButton = document.getElementById('broadcastButton');
        const messageInput = document.getElementById('messageInput');
        const statusMessage = document.getElementById('statusMessage');
        
        // --- Initialization and Authentication ---

        auth.onAuthStateChanged(user => {
            if (user) {
                broadcastButton.disabled = false;
                broadcastButton.textContent = 'SEND BROADCAST TO ALL USERS';
                statusMessage.textContent = `Authenticated as: ${user.email || user.uid}`;
            } else {
                // If not logged in, prompt user to log in first (e.g., via dailyphoto.html or a separate login)
                statusMessage.textContent = 'Please log in to Firebase first.';
                broadcastButton.textContent = 'Log in Required';
                // For quick testing, you can use signInAnonymously() here:
                // auth.signInAnonymously().catch(e => statusMessage.textContent = 'Login failed: ' + e.message);
            }
        });

        // --- Broadcast Logic ---

        broadcastButton.addEventListener('click', async () => {
            if (broadcastButton.disabled) return;
            
            statusMessage.textContent = 'Sending broadcast...';
            broadcastButton.disabled = true;
            
            const customMessage = messageInput.value.trim();
            
            try {
                const result = await sendBroadcast({ message: customMessage });
                
                if (result.data.success) {
                    statusMessage.textContent = `âœ… Success: ${result.data.message}`;
                    statusMessage.style.color = 'green';
                } else {
                    statusMessage.textContent = `âš ï¸ Warning: ${result.data.message}`;
                    statusMessage.style.color = 'orange';
                }

            } catch (error) {
                console.error("Error calling function:", error);
                statusMessage.textContent = `âŒ Error: ${error.message}`;
                statusMessage.style.color = 'red';
            } finally {
                broadcastButton.disabled = false;
                setTimeout(() => statusMessage.style.color = 'gray', 5000);
            }
        });

    </script>
</body>
</html>
