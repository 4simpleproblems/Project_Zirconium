<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlassMusic</title>
    <script src="https://connect.soundcloud.com/sdk/sdk-3.3.2.js"></script>
    
    <style>
        /* --- Base & Resets --- */
        :root {
            --bg-color: #0f0f1a;
            --glass-bg: rgba(25, 25, 40, 0.5);
            --glass-border: rgba(255, 255, 255, 0.1);
            --primary-text: #ffffff;
            --secondary-text: #b3b3b3;
            --accent-color: #1ed760;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--primary-text);
            overflow: hidden; /* Hide main scrollbar */
        }

        button {
            background: none;
            border: none;
            color: inherit;
            font: inherit;
            cursor: pointer;
        }

        img {
            max-width: 100%;
            display: block;
        }

        /* --- Glassy Texture Class --- */
        .glassy {
            background-color: var(--glass-bg);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
        }

        /* --- Main App Layout --- */
        #app-container {
            display: grid;
            grid-template-rows: 1fr auto;
            height: 100vh;
        }

        /* --- Main View (Search, Library, etc.) --- */
        #main-view {
            overflow-y: auto; /* Allow content to scroll */
            padding: 24px;
            padding-bottom: 120px; /* Space for bottom player */
        }

        header {
            margin-bottom: 24px;
        }

        #search-form {
            display: flex;
            gap: 12px;
        }

        #search-input {
            flex-grow: 1;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid var(--glass-border);
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            color: var(--primary-text);
        }

        #search-button {
            padding: 12px 20px;
            font-weight: 600;
            background-color: var(--accent-color);
            color: var(--bg-color);
            border-radius: 8px;
        }

        #results-container h2 {
            margin-bottom: 16px;
        }

        .track-list {
            display: grid;
            gap: 12px;
        }

        .track-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .track-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .track-item .track-cover {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            object-fit: cover;
            cursor: pointer;
        }

        .track-info {
            flex-grow: 1;
            min-width: 0; /* Prevents text overflow issues */
        }

        .track-info .track-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .track-info .track-artist {
            font-size: 14px;
            color: var(--secondary-text);
            cursor: pointer;
        }
        
        .track-info .track-artist:hover {
            text-decoration: underline;
        }

        .explicit-mark {
            display: inline-block;
            font-size: 10px;
            font-weight: 700;
            background-color: rgba(255, 255, 255, 0.2);
            color: var(--primary-text);
            padding: 2px 4px;
            border-radius: 2px;
            margin-left: 6px;
            transform: translateY(-2px);
        }

        .track-actions {
            display: flex;
            gap: 16px;
            font-size: 20px;
            color: var(--secondary-text);
        }
        
        .track-actions button:hover {
            color: var(--primary-text);
        }

        /* --- Bottom Player Bar --- */
        #bottom-player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 90px;
            padding: 16px 24px;
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 20px;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            transform: translateY(100%); /* Hidden by default */
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        #bottom-player-bar.visible {
            transform: translateY(0);
        }

        #bottom-player-bar .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
        }

        #bottom-player-bar .player-cover {
            width: 58px;
            height: 58px;
            border-radius: 6px;
        }

        #bottom-player-bar .player-track-info {
            min-width: 0;
        }
        
        #bottom-player-bar .player-track-info .track-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        #bottom-player-bar .player-track-info .track-artist {
            font-size: 14px;
            color: var(--secondary-text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #bottom-player-bar .player-controls-center {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .player-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

        .player-slider-container .time-display {
            font-size: 12px;
            color: var(--secondary-text);
            min-width: 40px;
            text-align: center;
        }

        #player-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        #player-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--primary-text);
            border-radius: 50%;
        }
        
        #player-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--primary-text);
            border-radius: 50%;
            border: none;
        }

        #bottom-player-bar .player-buttons {
            display: flex;
            justify-content: center;
            gap: 24px;
            font-size: 24px;
        }
        
        #bottom-player-bar .player-buttons .play-pause-btn {
            font-size: 32px;
        }

        #bottom-player-bar .player-actions-right {
            font-size: 20px;
        }

        /* --- Full Screen Player --- */
        #full-screen-player {
            position: fixed;
            inset: 0;
            z-index: 100;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            
            background-color: rgba(0,0,0,0.5); /* Fallback */
            backdrop-filter: blur(50px) saturate(180%);

            opacity: 0;
            pointer-events: none;
            transform: scale(1.1);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        #full-screen-player.visible {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        /* Liquid Blur Background */
        #full-screen-player::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: -1;
            background-size: cover;
            background-position: center;
            filter: blur(80px) brightness(0.6);
            transform: scale(1.2);
            opacity: 0.8;
            /* background-image will be set by JS */
        }
        
        #close-full-player {
            position: absolute;
            top: 24px;
            left: 24px;
            font-size: 30px;
            color: var(--secondary-text);
        }
        
        #close-full-player:hover {
            color: var(--primary-text);
        }

        .full-player-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
            width: 100%;
            max-width: 400px;
        }

        #full-player-cover {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .full-player-info {
            text-align: center;
        }

        #full-player-title {
            font-size: 24px;
            font-weight: 700;
        }

        #full-player-artist {
            font-size: 18px;
            color: var(--secondary-text);
            font-weight: 500;
        }

        .full-player-controls {
            width: 100%;
            max-width: 400px;
        }

        .full-player-slider-container {
            width: 100%;
        }

        .full-player-slider-container .time-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--secondary-text);
            margin-top: 8px;
        }
        
        #full-player-slider {
             -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
        }
        
        #full-player-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary-text);
            border-radius: 50%;
        }
        
        #full-player-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: var(--primary-text);
            border-radius: 50%;
            border: none;
        }

        .full-player-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 24px;
            font-size: 32px;
        }

        .full-player-buttons .play-pause-btn {
            font-size: 60px;
        }

    </style>
</head>
<body>

    <div id="app-container">
        <main id="main-view">
            <header>
                <h1>Welcome to GlassMusic</h1>
                <form id="search-form">
                    <input type="search" id="search-input" placeholder="Search for songs or artists..." required>
                    <button type="submit" id="search-button">Search</button>
                </form>
            </header>

            <section id="results-container">
                <h2>Results</h2>
                <div class="track-list" id="track-list">
                    </div>
            </section>
        </main>

        <div id="bottom-player-bar" class="glassy">
            <div class="player-info">
                <img src="" alt="Album Cover" class="player-cover" id="bottom-player-cover">
                <div class="player-track-info">
                    <div class="track-title" id="bottom-player-title">Track Title</div>
                    <div class="track-artist" id="bottom-player-artist">Artist Name</div>
                </div>
            </div>

            <div class="player-controls-center">
                <div class="player-buttons">
                    <button class="prev-btn">⏮</button>
                    <button class="play-pause-btn" data-action="play">▶️</button>
                    <button class="next-btn">⏭</button>
                </div>
                <div class="player-slider-container">
                    <span class="time-display" id="current-time">0:00</span>
                    <input type="range" id="player-slider" value="0" min="0" max="100" step="0.1">
                    <span class="time-display" id="duration">0:00</span>
                </div>
            </div>

            <div class="player-actions-right">
                <button class="fav-btn">🤍</button>
            </div>
        </div>

        <div id="full-screen-player">
            <button id="close-full-player">⌄</button>
            <div class="full-player-content">
                <img src="" alt="Album Cover" id="full-player-cover">
                <div class="full-player-info">
                    <h2 id="full-player-title">Track Title</h2>
                    <h3 id="full-player-artist">Artist Name</h3>
                </div>
            </div>
            
            <div class="full-player-controls">
                <div class="full-player-slider-container">
                    <input type="range" id="full-player-slider" value="0" min="0" max="100" step="0.1">
                    <div class="time-labels">
                        <span id="full-player-current-time">0:00</span>
                        <span id="full-player-duration">0:00</span>
                    </div>
                </div>
                <div class="full-player-buttons">
                    <button class="prev-btn">⏮</button>
                    <button class="play-pause-btn" data-action="play">▶️</button>
                    <button class="next-btn">⏭</button>
                </div>
            </div>
        </div>
    </div>

    <audio id="audio-player"></audio>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- CRITICAL API KEY ---
            // You MUST get this from soundcloud.com network traffic.
            // See the note at the top of this file.
            const YOUR_CLIENT_ID = 'ryRUzIe9hOPkIaQ8QRP97XcuYzdhStHs'; 
            
            if (YOUR_CLIENT_ID === 'PASTE_YOUR_CLIENT_ID_HERE') {
                alert('CRITICAL ERROR: Please read the note at the top of this HTML file and add your SoundCloud Client ID to the JavaScript section.');
            }

            // --- DOM Elements ---
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            const trackList = document.getElementById('track-list');
            const resultsContainer = document.getElementById('results-container');
            
            const audioPlayer = document.getElementById('audio-player');
            let currentTrack = null;

            // Player Bar Elements
            const bottomPlayerBar = document.getElementById('bottom-player-bar');
            const bottomPlayerCover = document.getElementById('bottom-player-cover');
            const bottomPlayerTitle = document.getElementById('bottom-player-title');
            const bottomPlayerArtist = document.getElementById('bottom-player-artist');
            const playerSlider = document.getElementById('player-slider');
            const currentTimeDisplay = document.getElementById('current-time');
            const durationDisplay = document.getElementById('duration');

            // Full Screen Player Elements
            const fullScreenPlayer = document.getElementById('full-screen-player');
            const closeFullScreenPlayer = document.getElementById('close-full-player');
            const fullPlayerCover = document.getElementById('full-player-cover');
            const fullPlayerTitle = document.getElementById('full-player-title');
            const fullPlayerArtist = document.getElementById('full-player-artist');
            const fullPlayerSlider = document.getElementById('full-player-slider');
            const fullPlayerCurrentTime = document.getElementById('full-player-current-time');
            const fullPlayerDuration = document.getElementById('full-player-duration');

            // All Play/Pause Buttons
            const playPauseButtons = document.querySelectorAll('.play-pause-btn');

            // --- IndexedDB ---
            let db;
            function initDB() {
                const request = indexedDB.open('glassMusicDB', 1);

                request.onerror = (event) => {
                    console.error('IndexedDB error:', event.target.errorCode);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains('favorites')) {
                        db.createObjectStore('favorites', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('library')) {
                        db.createObjectStore('library', { keyPath: 'id' });
                    }
                    if (!db.objectStoreNames.contains('playlists')) {
                        db.createObjectStore('playlists', { keyPath: 'name' });
                    }
                };

                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('Database initialized');
                };
            }
            
            function dbAdd(storeName, data) {
                if (!db) return;
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                store.add(data);
            }
            
            // (You would add more DB functions: dbDelete, dbGet, etc.)

            // --- SoundCloud SDK Init ---
            try {
                SC.initialize({
                    client_id: YOUR_CLIENT_ID
                });
            } catch (error) {
                console.error('SoundCloud SDK Init Error:', error);
            }

            // --- API Functions ---
            function searchSoundCloud(query) {
                SC.get('/tracks', {
                    q: query,
                    limit: 20
                }).then(tracks => {
                    displayResults(tracks, `Search Results for "${query}"`);
                }).catch(error => {
                    console.error('Search error:', error);
                    trackList.innerHTML = '<p>Error loading results. Your Client ID might be invalid.</p>';
                });
            }

            function getArtistTracks(userId, artistName) {
                SC.get(`/users/${userId}/tracks`)
                  .then(tracks => {
                    displayResults(tracks, `More from ${artistName}`);
                  }).catch(error => {
                    console.error('Artist track error:', error);
                  });
            }

            // --- UI Functions ---
            function displayResults(tracks, title) {
                resultsContainer.querySelector('h2').textContent = title;
                trackList.innerHTML = ''; // Clear previous results
                if (tracks.length === 0) {
                    trackList.innerHTML = '<p>No results found.</p>';
                    return;
                }
                
                tracks.forEach(track => {
                    // Fix for low-res artwork
                    const artwork = track.artwork_url ? track.artwork_url.replace('-large.jpg', '-t500x500.jpg') : 'https://via.placeholder.com/50';

                    // "E" Mark Logic - This is a HACK as SoundCloud API doesn't provide a reliable explicit flag.
                    let explicitMark = '';
                    if (track.title.toLowerCase().includes('explicit') || (track.tag_list && track.tag_list.toLowerCase().includes('explicit'))) {
                        explicitMark = '<span class="explicit-mark">E</span>';
                    }

                    const trackHTML = `
                        <div class="track-item">
                            <img src="${artwork}" alt="${track.title}" class="track-cover play-button" data-track-id="${track.id}">
                            <div class="track-info">
                                <div class="track-title">${track.title} ${explicitMark}</div>
                                <div class="track-artist" data-artist-id="${track.user.id}" data-artist-name="${track.user.username}">${track.user.username}</div>
                            </div>
                            <div class="track-actions">
                                <button class="fav-button" title="Add to Favorites">🤍</button>
                                <button class="library-button" title="Add to Library">➕</button>
                            </div>
                        </div>
                    `;
                    const trackElement = document.createElement('div');
                    trackElement.innerHTML = trackHTML.trim();
                    
                    // Store the full track object on the element for later use
                    trackElement.querySelector('.track-item').dataset.track = JSON.stringify(track);

                    trackList.appendChild(trackElement.firstElementChild);
                });
            }

            // --- Player Logic ---
            async function playSong(track) {
                currentTrack = track;
                
                // This uses the "internal" stream endpoint to get a direct URL
                // This is more reliable for custom players than SC.stream()
                try {
                    const response = await fetch(`https://api.soundcloud.com/i1/tracks/${track.id}/streams?client_id=${YOUR_CLIENT_ID}`);
                    if (!response.ok) throw new Error('Stream fetch failed');
                    
                    const streamData = await response.json();
                    const streamUrl = streamData.http_mp3_128_url;

                    audioPlayer.src = streamUrl;
                    audioPlayer.play();
                    
                    updatePlayerUI(track);
                    bottomPlayerBar.classList.add('visible');
                    setPlayPauseState('pause');
                    
                } catch (error) {
                    console.error('Error playing track:', error);
                    alert('Could not play this track. It may not be streamable.');
                }
            }
            
            function updatePlayerUI(track) {
                const artwork = track.artwork_url ? track.artwork_url.replace('-large.jpg', '-t500x500.jpg') : 'https://via.placeholder.com/500';
                
                // Bottom Bar
                bottomPlayerCover.src = artwork;
                bottomPlayerTitle.textContent = track.title;
                bottomPlayerArtist.textContent = track.user.username;
                
                // Full Screen Player
                fullPlayerCover.src = artwork;
                fullPlayerTitle.textContent = track.title;
                fullPlayerArtist.textContent = track.user.username;
                
                // Liquid Blur Background
                fullScreenPlayer.style.setProperty('--bg-image', `url(${artwork})`);
                // This is a bit of a trick: We set the background on the ::before pseudo-element
                // We need to inject a style rule or use CSS variables.
                // We'll create a style tag to hold this dynamic rule
                let dynamicStyle = document.getElementById('dynamic-player-bg');
                if (!dynamicStyle) {
                    dynamicStyle = document.createElement('style');
                    dynamicStyle.id = 'dynamic-player-bg';
                    document.head.appendChild(dynamicStyle);
                }
                dynamicStyle.innerHTML = `
                    #full-screen-player::before {
                        background-image: url(${artwork});
                    }
                `;
            }
            
            function setPlayPauseState(state) {
                if (state === 'play') {
                    playPauseButtons.forEach(btn => {
                        btn.innerHTML = '▶️';
                        btn.dataset.action = 'play';
                    });
                } else {
                    playPauseButtons.forEach(btn => {
                        btn.innerHTML = '⏸';
                        btn.dataset.action = 'pause';
                    });
                }
            }

            function togglePlayPause() {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    setPlayPauseState('pause');
                } else {
                    audioPlayer.pause();
                    setPlayPauseState('play');
                }
            }

            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            // --- Event Listeners ---
            
            // DB Init
            initDB();

            // Search
            searchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = searchInput.value.trim();
                if (query) {
                    searchSoundCloud(query);
                }
            });

            // Click Delegation for Tracks
            trackList.addEventListener('click', (e) => {
                const trackItem = e.target.closest('.track-item');
                if (!trackItem) return;

                const track = JSON.parse(trackItem.dataset.track);

                // Play song
                if (e.target.classList.contains('play-button')) {
                    playSong(track);
                }
                
                // Go to artist page
                if (e.target.classList.contains('track-artist')) {
                    const userId = e.target.dataset.artistId;
                    const artistName = e.target.dataset.artistName;
                    getArtistTracks(userId, artistName);
                }
                
                // Favorite
                if (e.target.classList.contains('fav-button')) {
                    dbAdd('favorites', track);
                    e.target.innerHTML = '❤️'; // Feedback
                    e.target.disabled = true;
                }
                
                // Add to Library
                if (e.target.classList.contains('library-button')) {
                    dbAdd('library', track);
                    e.target.innerHTML = '✅'; // Feedback
                    e.target.disabled = true;
                }
            });

            // Player Bar Controls
            playPauseButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Stop click from bubbling to bar
                    if (!currentTrack) return;
                    togglePlayPause();
                });
            });

            // Audio Element Events
            audioPlayer.addEventListener('loadedmetadata', () => {
                const totalTime = audioPlayer.duration;
                playerSlider.max = totalTime;
                fullPlayerSlider.max = totalTime;
                durationDisplay.textContent = formatTime(totalTime);
                fullPlayerDuration.textContent = formatTime(totalTime);
            });
            
            audioPlayer.addEventListener('timeupdate', () => {
                const currentTime = audioPlayer.currentTime;
                playerSlider.value = currentTime;
                fullPlayerSlider.value = currentTime;
                currentTimeDisplay.textContent = formatTime(currentTime);
                fullPlayerCurrentTime.textContent = formatTime(currentTime);
            });
            
            audioPlayer.addEventListener('ended', () => {
                setPlayPauseState('play');
                // Add "next song" logic here if you have a queue
            });

            // Slider Seeking
            function handleSliderInput(e) {
                audioPlayer.currentTime = e.target.value;
            }
            playerSlider.addEventListener('input', handleSliderInput);
            fullPlayerSlider.addEventListener('input', handleSliderInput);

            // Full Screen Player Toggle
            bottomPlayerBar.addEventListener('click', () => {
                fullScreenPlayer.classList.add('visible');
            });
            
            closeFullScreenPlayer.addEventListener('click', () => {
                fullScreenPlayer.classList.remove('visible');
            });
            
        });
    </script>
</body>
</html>
